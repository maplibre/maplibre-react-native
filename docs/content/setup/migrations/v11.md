# Migrating to v11

MapLibre React Native v11 is the first release to only support the new architecture. As this required significant changes to the implementation, the APIs where also improved and are based upon MapLibre GL.

## Changes to `MapView` Component

### Android View is now `GLSurfaceView` by Default

On Android the `MapView` now uses `GLSurfaceView` per default instead of `TextureView` for native rendering. This aligns with the default of the native SDKs, this switch is [pre-dating MapLibre](https://blog.mapbox.com/asynchronous-rendering-on-android-831722ac1837) and was never propagated to the React Native wrapper. To fall back to the `TextureView` set the `androidView="texture"` prop.

### Removed Props

The following props have been removed from the `MapView` without replacement:

- `localizeLabels`: This was used in conjunction with Mapbox specific map styles for toggling localization, MapLibre aims to be vendor-agnostic and the prop has therefore been removed
- `regionWillChangeDebounceTime` & `regionDidChangeDebounceTime`: Debouncing should be handled in the app code if needed

### Ornament Props

All ornaments (attribution, logo, compass) use an aligned API now. Enable/disable the visibility with the `attribution`/`logo`/`compass` boolean props. Position them with the `attributionPosition`/`logoPosition`/`compassPosition` props which only accepts an object with `top`/`bottom` and `left`/`right` properties.

### `contentInset`

Now uses unified `ViewPadding` type:

```diff
<MapView
-  contentInset={[16, 16, 16, 16]}
+  contentInset={{ top: 16, right: 16, bottom: 16, left: 16 }}
/>
```

### Interaction Props

Interaction props have been aligned with the MapLibre GL API as far as possible.

```diff
<MapView
-  scrollEnabled={false}
+  dragPan={false}
-  zoomEnabled={false}
+  touchAndDoubleTapZoom={false}
-  rotateEnabled={false}
+  touchRotate={false}
-  pitchEnabled={false}
+  touchPitch={false}
/>
```

### Events

Events now follow the pattern of `NativeSyntheticEvent` and passes the payload in the `nativeEvent` property.

### Imperative Methods on `MapRef`

Imperative methods have been aligned with the MapLibre GL API as far as possible.

- Renamed methods:
  - `getVisibleBounds()` -> `getBounds()`
  - `getPointInView()` -> `project()`
    - Params now uses `{ longitude, latitude }` as params
  - `getCoordinateFromView()` -> `unproject()`
    - Params now uses `{ locationX, locationY }` as params
- Unified methods:
  - `queryRenderedFeaturesAtPoint()` & `queryRenderedFeaturesInRect()` -> `queryRenderedFeatures()`
    - Now instead of passing pixel coordinates, geographic coordinates are being required to query
- More complete API by adding:
  - `getBearing()`
  - `getPitch()`
  - `getViewState()`

## `Light` Component removed

The `Light` component has been removed. Configuration is now passed directly as a `light` prop to `MapView`.

```diff
<MapView
+  light={{
+    position: [1.5, 90, 80],
+    color: "#ffffff",
+    intensity: 0.5,
+  }}
>
-  <Light
-    style={{
-      position: [1.5, 90, 80],
-      color: "#ffffff",
-      intensity: 0.5,
-    }}
-  />
  {/* Other map content */}
</MapView>
```

## Changes to `Camera` Component

### Changes to Camera Stop Props

The prop was renamed and the structure was aligned with MapLibre GL and `react-map-gl`:

```diff
<Camera
-  centerCoordinate={[longitude, latitude]}
+  center={{ longitude, latitude }}
-  zoomLevel={10}
+  zoom={10}
- heading={15}
+  bearing={15}
  pitch={30}
-  animationDuration={2000}
+  duration={2000}
-  animationMode="flyTo"
+  easing="fly"
/>
```

String Literal `CameraAnimationMode` has been renamed to `CameraEasing` and changed as follows:

- `moveTo` -> `undefined`
- `linearTo` -> `linear`
- `easeTo` -> `ease`
- `flyTo` -> `fly`

### Prop `defaultSettings` changed to `initialViewState`

The prop was renamed and the structure was aligned with MapLibre GL and `react-map-gl`:

```diff
<Camera
-  defaultSettings={{
+  initialViewState={{
-    centerCoordinate: [longitude, latitude],
+    center: { longitude, latitude },
-    zoomLevel: 10,
+    zoom: 10,
-    heading: 15,
+    bearing: 15
    pitch: 30,
-    bounds: {
-      ne: [east, north],
-      sw: [west, south],
-      paddingTop: 16,
-      paddingRight: 16,
-      paddingBottom: 16,
-      paddingLeft: 16,
-    },
+    bounds: [west, south, east, north],
+    padding: { top: 16, right: 16, bottom: 16, left: 16 },
  }}
/>
```

### Follow Prop Changes

The `followUserLocation` and `followUserMode` prop has been unified to `trackUserLocation`.

The enum `UserTrackingMode` has been replaced by the string literal `TrackUserLocation`:

- `normal` -> `default`
- `compass` -> `heading`
- `course` -> `course`

The `follow` props to control the camera during tracking have been removed in favor of the default camera stop props:

```diff
<Camera
-  followUserLocation
-  followUserMode="normal"
+  trackUserLocation="default"
-  followZoomLevel={15}
+  zoom={15}
-  followHeading={0}
+  bearing={0}
-  followPitch={45}
+  pitch={45}
/>
```

### Imperative Methods on `CameraRef`

Imperative methods have been aligned with the MapLibre GL API as far as possible.

- `setCamera()` -> `setStop()`
- `moveTo()` -> `jumpTo()`
- More complete API by adding:
  - `easeTo()`





## Changes to `LocationManager` Module

### `GeolocationPosition` Type

The `LocationManager` module now emits `GeolocationPosition` type, renamed from `Location` type. It also reassembles the web [`GeolocationPosition`](https://developer.mozilla.org/en-US/docs/Web/API/GeolocationPosition) much more closely. Previously there was partial support for `heading` and `course`. This has been unified as defined by the spec to `heading` which now gives the direction of travel on both platforms. Retrieving the compass direction is not supported due to native limitations. 

### Incorporation of `requestAndroidPermissions`

The locationManager now also incorporates the `requestAndroidPermissions` function, the standalone function has been removed:

```diff
-requestAndroidPermissions()
+LocationManager.requestAndroidPermissions()
```

## Changes to `UserLocation` Component

### Replaced `onUpdate` with `useCurrentPosition` Hook

The `onUpdate` prop has been removed in favor of the new `useCurrentPosition` hook for accessing the user location data:

```diff
+const position = useCurrentPosition();

return (
  <UserLocation
-    onUpdate={(position) => {
-      // ...
-    }}
  />
)
```

### Added the `accuracy` Prop

It's now possible to show the accuracy circle around the user location by enabling the `accuracy` prop, replacing the previous circle that didn't have any meaning:

```diff
<UserLocation 
+  accuracy
/>
```

### Separation of `NativeUserLocation`

The `NativeUserLocation`, which previously was used for `renderMode="native"`, has been branched out as a separate component:

```diff
-<UserLocation renderMode="native" />
+<NativeUserLocation />
```

This component only relies on the default MapLibre Native user location implementations without any custom React Native customizations.
